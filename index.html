<!doctype html>
<html>
<head>
	<meta charset='utf-8'>
	<title>madeincluj</title>

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
	<!--[if lte IE 8]>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="css/app.css"/>
	
	<script type="text/javascript" src="//use.typekit.net/fda0kgu.js"></script>
	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

	<script type="text/javascript" src="js/lib/leaflet-src.js"></script>
	<script type="text/javascript" src="js/lib/tile.stamen.js"></script>
	<script type="text/javascript" src="js/lib/OSMBuildings-Leaflet.js"></script>
	<script type="text/javascript" src="js/lib/underscore-min.js"></script>
	<script type="text/javascript" src="js/lib/Leaflet-KML.js"></script>
	<script type="text/javascript" src="js/lib/Leaflet-Google.js"></script>	
	<script type="text/javascript" src="js/lib/leaflet.photomarker-src.js"></script>
	<script type="text/javascript" src="js/lib/leaflet-hash.js"></script>
	<script type="text/javascript" src="js/lib/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="js/lib/handlebars.js"></script>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript" src="js/layer.instagram.js"></script>
	<script type="text/javascript" src="js/layer.building-photos.js"></script>
	<script type="text/javascript" src="js/layer.street-names.js"></script>
	<script type="text/javascript" src="js/layer.historical-maps.js"></script>
	<script type="text/javascript" src="js/gmaps.js"></script>
	<script src="http://maps.google.com/maps/api/js?v=3&sensor=false"></script>
	<script type="text/javascript">

		var geojson;
		var latoffset = 0.000319661965654916 + 0.000037661515271736334;
		var lngoffset = -0.00035941600799560547 + 0.00006973743438720703;
		function load(data) {
			geojson = data;
			geojson.features.forEach(function(feature) {
				feature.properties.height = 20;
				feature.properties.minHeight = 0;
				if (feature.geometry && feature.geometry.coordinates) {
					var coords = feature.geometry.coordinates;
					coords[0].forEach(function(c) {
						c[0] += latoffset;
						c[1] += lngoffset;
						c.length = 2;
					});
				}
			});
			// geojson.features = geojson.features.slice(5011, 5013);
		};

		function loadgeojson(data) {
			geojson = data;
			geojson.features.forEach(function(f) {
				f.properties.height = 20;
				var color = "rgb(" + Math.floor(Math.random() * 255) + "," + Math.floor(Math.random() * 255) + "," + Math.floor(Math.random() * 255) + ")";
				f.properties.roofColor = color;
				f.properties.wallColor = color;
			});
		};

		window.onload = function() {
			var map = L.map('map', {
				center: [46.7684, 23.5919],
				zoom: 15,
				minZoom: 13,
				maxZoom: 20,
				maxBounds: new L.LatLngBounds([46.3,23], [47, 24])
			});
			var stamenLayer = new L.StamenTileLayer("toner", {
				detectRetina: true,
				reuseTiles: true
			});	
			// map.addLayer(stamenLayer);

			window.stamen = stamenLayer;

			window.map = map;

			var ggl = new L.Google('ROADMAP', {
				mapOptions: {
					styles: GMAPS_STYLES
				}
			});
			map.addLayer(ggl);


			// var track = new L.KML("kml/cluj3D.kml", {async: true});
			// track.on("loaded", function(e) { map.fitBounds(e.target.getBounds()); });
			// map.addLayer(track);

			// var osmb = new OSMBuildings(map);

			// osmb.setData(geojson).setStyle({
			// 	// shadows: false
			// });

			// osmb.loadData();

			var coords = window.coords = [];
			map.on('click', function(e) {
				coords.push(e.latlng);
			});
			var hash = L.hash(map);

			// Layer toggle controls
			var historicalTiles = '../historical-maps/img/1869/{z}/{x}/{y}.png';
			var options = {
				minZoom: 13,
				maxZoom: 17,
				opacity: 0.7,
				tms: true
			};
			var historicalLayer = L.tileLayer(historicalTiles, options);
			var instaLayer = MIC.InstagramLayer.initialize(map).enable();
			var buildingPhotosLayer = MIC.BuildingPhotosLayer.initialize(map).enable();

			var overlayMaps = {
				"Hărți istorice": historicalLayer,
        		"Instagram #madeincluj": instaLayer.featureGroup,
        		"Clădiri '60-'80": buildingPhotosLayer.featureGroup
				// add more layers here as they are integrated
			};

			L.control.layers(null, overlayMaps).addTo(map);

			MIC.initialize();

			// var instagram = MIC.InstagramLayer().enable();
		}
	</script>
</head>
<body>

	<div id='header'>
		<h1>madeincluj</h1>
		<ul id='nav'>
			<li><a href='#'>Despre proiect</a></li>
			<li><a href='#'>Echipa</a></li>
			<li><a href='#'>Contact</a></li>
		</div>
	</div>
	<div id='map-container'>
		<div id='map'></div>
	</div>
	<div id='footer'></div>

	<div id='popup-container'>
		<a href='#' class='close-popup'>&times;</a>
		<div class='popup-content'></div>
	</div>

	<!-- templates -->

	<!-- Building photomarker template -->
	<script id='tmpl-building-photo-marker' type='text/x-handlebars'>
		<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100px" height="100px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve">
		 <g>
			<clipPath id="bubble-mask">
				<path d="M94.5,45.239c0-24.577-19.923-44.5-44.5-44.5c-24.576,0-44.5,19.923-44.5,44.5c0,22.495,16.694,41.08,38.368,44.069l5.834,10.109l5.79-10.028C77.476,86.683,94.5,67.955,94.5,45.239z"/>
			</clipPath>
		 </g>
		 <image clip-path="url(#bubble-mask)" height="100%" width="100%" xlink:href="https://secure.gravatar.com/avatar/c70822569ff3459a2d82a5033d401dc8?d=mm&amp;s=204" />
		</svg>
	</script>

	<!-- Instagram marker template -->
	<script id='tmpl-instagram-marker' type='text/x-handlebars'>
		<div class='instagram-marker {{type}}'>
			<div class='photo'>
				<img src="{{images.thumbnail.url}}" width="{{images.thumbnail.width}}" height="{{images.thumbnail.height}}"/>
			</div>
		</div>
	</script>

	<!-- Instagram popup template -->
	<script id='tmpl-instagram-item' type='text/x-handlebars'>
		<div class='instagram-item'>
			<div class='photo'>
				<img src="{{images.standard_resolution.url}}" width="{{images.standard_resolution.width}}" height="{{images.standard_resolution.height}}"/>
			</div>
			<div class='meta'>
				<img src="{{user_photo}}" height="25" width="25"/>
				<span><a href="http://instagram.com/{{user_name}}">{{user_name}}</a>, {{caption}}</span>
			</div>
		</div>
	</script>

	<!-- Building popup template -->
	<script id='tmpl-building-item' type='text/x-handlebars'>


		<div class='building-item'>

			<div class='item-gallery'>

				<div class='item-gallery-view'>
					<img src={{ photos.0.large }}/>
				</div>
				
				<div class='item-gallery-thumbs'>
				{{#each photos}}
					<img src='{{thumb}}' data-large='{{large}}'/>
				{{/each}}
				</div>

			</div>

			<div class='item-info'>
				<h2>{{ name }}</h2>
				<h3>{{ architect }}, {{ year }}</h3>

				<div class='item-description'>{{ description }}</div>
			</div>

		</div>

	</script>

</body>
</html>
