<!doctype html>
<html>
<head>
	<title>madeincluj</title>

	 <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
 <!--[if lte IE 8]>
     <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
 <![endif]-->
 <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic' rel='stylesheet' type='text/css'>

	<style type="text/css">

		body {
			font-family: 'Lato', 'Helvetica', 'Arial', sans-serif;
		}

		#header {
			position:absolute;
			left: 0;
			right: 0;
			top: 0;
			padding: 1em;
			z-index: 2;
		}

		#header h1 {
			font-size: 2em;
			margin: 0;
		}

		#map {
			position:absolute;
			left: 0;
			right: 0;
			top: 0;
			bottom: 0;
			background: #eee;
			z-index: 1;
		}

		#map .leaflet-control-zoom { margin-top: 8em; }

		#map .leaflet-control-attribution a { color: #000; }

		#bubble-butt {
			z-index:1000;
			position: absolute;
			-moz-transition: 0.2s all;
			-webkit-transition: 0.2s all;
			left: 50%;
			top: 50%;
		}

		#bubble-butt:hover {
			width: 200px;
			height: 200px;
			-moz-transform: translate(-50px, -100px);
			-webkit-transform: translate(-50px, -100px);
		}
	</style>

	<script src="js/lib/leaflet.js"></script>
	<script type="text/javascript" src="js/lib/tile.stamen.js"></script>
  <script type="text/javascript" src="js/lib/OSMBuildings-Leaflet.js"></script>
	<script type="text/javascript" src="js/lib/underscore-min.js"></script>
	<script type="text/javascript" src="js/lib/Leaflet-KML.js"></script>
	<script type="text/javascript" src="js/lib/Leaflet-Google.js"></script>	
	<script type="text/javascript" src="js/lib/L.TileLayer.Zoomify.js"></script>
	<script type="text/javascript" src="js/gmaps.js"></script>

	<script src="http://maps.google.com/maps/api/js?v=3&sensor=false"></script>
	<script type="text/javascript">

    var geojson;
    var latoffset = 0.000319661965654916 + 0.000037661515271736334;
    var lngoffset = -0.00035941600799560547 + 0.00006973743438720703;
    function load(data) {
      geojson = data;
      geojson.features.forEach(function(feature) {
        feature.properties.height = 20;
        feature.properties.minHeight = 0;
        if (feature.geometry && feature.geometry.coordinates) {
        	var coords = feature.geometry.coordinates;
        	coords[0].forEach(function(c) {
        		c[0] += latoffset;
        		c[1] += lngoffset;
        		c.length = 2;
        	});
        }
      });

    	// geojson.features = geojson.features.slice(5011, 5013);
    };

    function loadgeojson(data) {
    	console.log(data);
    	geojson = data;
    	geojson.features.forEach(function(f) {
    		f.properties.height = 20;
    		var color = "rgb(" + Math.floor(Math.random() * 255) + "," + Math.floor(Math.random() * 255) + "," + Math.floor(Math.random() * 255) + ")";
    		f.properties.roofColor = color;
    		f.properties.wallColor = color;
    	});
    };

		window.onload = function() {
			var map = L.map('map', {
				center: [46.7667, 23.5569],
				zoom: 16,
				minZoom: 13,
				maxZoom: 20,
				maxBounds: new L.LatLngBounds([46.3,23], [47, 24])
			});
			var layer = new L.StamenTileLayer("toner", {

				detectRetina: true,
				reuseTiles: true
			});	
			// map.addLayer(layer);

			window.stamen = layer;

			window.map = map;

			var ggl = new L.Google('ROADMAP', {
				mapOptions: {
					styles: GMAPS_STYLES
				}
			});
			map.addLayer(ggl);


			// var track = new L.KML("kml/cluj3D.kml", {async: true});
			// track.on("loaded", function(e) { map.fitBounds(e.target.getBounds()); });
			// map.addLayer(track);

			var osmb = new OSMBuildings(map);

			osmb.setData(geojson).setStyle({
				// shadows: false
			});

			// osmb.loadData();
	
			var coords = window.coords = [];
			map.on('click', function(e) {
				coords.push(e.latlng);
			});

			/* Strike 1: Simple image layer */
			var imageUrl = 'img/centru_cluj.jpg',
					imageBounds = new L.LatLngBounds([46.775568,23.581883], [46.766265,23.602299]);
			// L.imageOverlay(imageUrl, imageBounds).addTo(map);

			/* Strike 2: Use tile layers to display images */

			// L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			//     bounds: imageBounds,
			// }).addTo(map);

			// L.tileLayer('img/centru_cluj/TileGroup0/{z}-{x}-{y}.jpg', {
			//     zoomOffset: -16,
			//     bounds: imageBounds,
			// }).addTo(map);

			// L.tileLayer.zoomify('img/centru_cluj/', {
			//     width: 843,
			//     height: 619,
			//     tolerance: 0.8,
			// }).addTo(map);
		}
	</script>


  <script type="text/javascript" src="geojson/osm_buildings.geojson"></script>

<!--
  <script type="text/javascript" src="osm-buildings.json"></script>

  <script type='text/javascript'>
  	var osm_geojson = {
  		type: 'FeatureCollection',
  		features: buildings.map(function(building) {
  			var coords = [];
  			for (var i =0; i < building.footprint.length; i+=2) {
  				coords.push([ building.footprint[i+1], building.footprint[i]]);
  			}
  			return {
  				type: 'Feature',
  				properties: {
  					height: building.height,
  					id: building.id
  				},
  				geometry: {
  					type: 'Polygon',
  					coordinates: [coords]
  				}
  			};
  		})
  	};
  </script>

-->
</head>
<body>

	<div id='header'>
		<h1><img src='img/logo.png'/> madeincluj</h1>
	</div>
	<div id='map'></div>
	<svg id='bubble-butt' version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
	 width="100px" height="100px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve">
	 <g>
		<clipPath id="bubble-mask">
			<path d="M94.5,45.239c0-24.577-19.923-44.5-44.5-44.5c-24.576,0-44.5,19.923-44.5,44.5c0,22.495,16.694,41.08,38.368,44.069l5.834,10.109l5.79-10.028C77.476,86.683,94.5,67.955,94.5,45.239z"/>
		</clipPath>
	 </g>
	 <image clip-path="url(#bubble-mask)" height="100%" width="100%" xlink:href="https://secure.gravatar.com/avatar/c70822569ff3459a2d82a5033d401dc8?d=mm&amp;s=204" />
	</svg>

</body>
</html>